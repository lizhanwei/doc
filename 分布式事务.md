### EBay方案[消息表]
> 举个例子。  
还是以支付宝转账余额宝为例，假设有  
支付宝账户表：A（id，userId，amount）  
余额宝账户表：B（id，userId，amount）  
用户的userId=1；  
从支付宝转账1万块钱到余额宝的动作分为两步：  
1）支付宝表扣除1万：update A set amount=amount-10000 where userId=1;  
2）余额宝表增加1万：update B set amount=amount+10000 where userId=1;

```java
Begin transaction
         update A set amount=amount-10000 where userId=1;
         insert into message(userId, amount,status) values(1, 10000, 1);
End transaction
commit;


for each msg in queue
  Begin transaction
    select count(*) as cnt from message_apply where msg_id=msg.msg_id;
    if cnt==0 then
      update B set amount=amount+10000 where userId=1;
      insert into message_apply(msg_id) values(msg.msg_id);
  End transaction
  commit;

```

### 基于RocketMQ
[transaction-example](https://rocketmq.apache.org/docs/transaction-example/)

### 基于SAGA协议
[saga](https://github.com/apache/servicecomb-saga)